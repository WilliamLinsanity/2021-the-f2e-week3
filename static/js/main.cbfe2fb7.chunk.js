(this["webpackJsonpthef2e-week3"]=this["webpackJsonpthef2e-week3"]||[]).push([[0],{35:function(t,e,n){},36:function(t,e,n){},43:function(t,e,n){"use strict";n.r(e);var a=n(0),c=n.n(a),s=n(21),o=n.n(s),i=(n(35),n(36),n(2)),r=n(7),l=n(3),d=n(4),u=(n(40),n(5)),j=n.n(u),p=n(44),A=n(45),h=n(46),b=n(27),m=n(1);var O,x,g,f,v={ptxURL:"https://ptx.transportdata.tw/MOTC/v2/Bus",ptxBicycleURL:"https://ptx.transportdata.tw/MOTC/v2/Bike",ptxAuthorityURL:"https://ptx.transportdata.tw/MOTC/v2/Basic/Authority",getAuthorizationHeader:()=>{let t=(new Date).toGMTString(),e=new b.a("SHA-1","TEXT");return e.setHMACKey("D0MV31l-dasLMnv5qe9Ly56Rm6Y","TEXT"),e.update("x-date: "+t),{Authorization:'hmac username="675dad84079841b3a881006714b3d91e", algorithm="hmac-sha1", headers="x-date", signature="'+e.getHMAC("B64")+'"',"X-Date":t}},stationIcon:j.a.divIcon({className:"map-marker",iconSize:null,html:'<div class="stationIcon"></div>'}),userIcon:j.a.divIcon({className:"map-marker",iconSize:null,html:'<div class="userIcon"></div>'}),bikeIcon:j.a.divIcon({className:"map-marker",iconSize:null,html:'<div class="bikeIcon"></div>'}),emptyPositionIcon:j.a.divIcon({className:"map-marker",iconSize:null,number:1,html:'<div class="emptyIcon"></div>'}),getMinute:t=>{let{stopStatus:e,estimatedSeconds:n}=t;return 4===e?Object(m.jsx)("span",{className:"estimated_time off",children:"\u672a\u71df\u904b"}):3===e?Object(m.jsx)("span",{className:"estimated_time off",children:"\u672b\u73ed\u5df2\u904e"}):2===e?Object(m.jsx)("span",{className:"estimated_time off",children:"\u4ea4\u7ba1\u4e0d\u505c"}):1===e||void 0===e?Object(m.jsx)("span",{className:"estimated_time off",children:"\u672a\u767c\u8eca"}):n<120?Object(m.jsx)("span",{className:"estimated_time approaching",children:"\u9032\u7ad9\u4e2d"}):Object(m.jsxs)("span",{className:"estimated_time",children:[Object(m.jsx)("span",{className:"minute",children:Math.floor(n/60)}),"\xa0\u5206"]})},countyList:[{label:"\u53f0\u5317\u5e02",value:"Taipei"},{label:"\u65b0\u5317\u5e02",value:"NewTaipei"},{label:"\u6843\u5712\u5e02",value:"Taoyuan"},{label:"\u82d7\u6817\u7e23",value:"MiaoliCounty"},{label:"\u65b0\u7af9\u5e02",value:"Hsinchu"},{label:"\u53f0\u4e2d\u5e02",value:"Taichung"},{label:"\u81fa\u5357\u5e02",value:"Tainan"},{label:"\u5609\u7fa9\u5e02",value:"Chiayi"},{label:"\u9ad8\u96c4\u5e02",value:"Kaohsiung"},{label:"\u5c4f\u6771\u7e23",value:"PingtungCounty"},{label:"\u91d1\u9580\u7e23",value:"KinmenCounty"}],routesList:[{label:"\u96d9\u5317",value:"taipei"},{label:"\u6843\u5712\u5e02",value:"taoyuan"},{label:"\u53f0\u4e2d\u5e02",value:"taichung"},{label:"\u53f0\u5357\u5e02",value:"tainan"},{label:"\u9ad8\u96c4\u5e02",value:"kaohsiung"},{label:"\u516c\u8def\u5ba2\u904b",value:"highWayBus"},{label:"\u5176\u4ed6",value:"other"},{label:"\u5df2\u5b58\u8def\u7dda",value:"savedRoad"}]},S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAUCAYAAACqJ5zlAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAA2SURBVHgB3Y7BCQAgDMSCE7hh3bwj1A1qHycu4KuBwH0CR2auMkovDY1LDGDy2ChxZcYPGv04o9OJTaQq+wQAAAAASUVORK5CYII=";const N=d.a.div(O||(O=Object(l.a)(["\nbackground-color: #61A68A;\nheight: 55px;\ndisplay: flex;\nalign-items: center;\njustify-content: space-between;\npadding:16px 16px;\nposition: fixed;\nz-index:401;\ntop: 0;\nwidth: 100%;\n"]))),y=d.a.div(x||(x=Object(l.a)([""]))),U=d.a.div(g||(g=Object(l.a)(["\ncolor: #FFFFFF;\nfont-size: 20px;\n"]))),I=d.a.div(f||(f=Object(l.a)([""])));var C,w,D=t=>{const{type:e,text:n,selectedCounty:a,routeUID:c,routeName:s,router:o,searchText:i,handleSearch:l}=t;return Object(m.jsxs)(N,{className:"map"===e?"relative-header":"",children:[Object(m.jsx)(y,{children:Object(m.jsx)(r.b,{to:o,children:Object(m.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACGSURBVHgB7dTBCYAwDAXQjxM4giM4ghvZDXQDR3EER3GEjhATjBgUL5IIQh/k+tOGtEBREFHNtUohAgfPtPNvwKHjEc7VwBMHJjq18CSBJryHJxmFjkQM8GbC37gtQoWv6YiynmhCBA7uzLUTIlzWtEMEGZE2yO4PzTRZnjbEq0HsZ1f83wbK6+CRq061nAAAAABJRU5ErkJggg==",alt:"arrow"})})}),"map"===e&&Object(m.jsx)(U,{children:n}),"input"===e&&Object(m.jsx)("input",{className:"search-input",placeholder:"\u516c\u8eca\u67e5\u8a62",defaultValue:i,onChange:t=>l(t.target.value)}),Object(m.jsx)(I,{children:"input"===e?Object(m.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACpSURBVHgB7ZTtDYQgDIbLhT3ubgOdyG7iKjqRboAjuEFtoyRIkIDoL32ShvLVNy8QAF6eAxFVHAOVY6SWrascAbOlHZSBHLNSqvYdCC0UIjWkkO1/DhYZ6yg39wkKXIkODfL5/c/mPocO2DJu99Kk5NkCl3PXK9KRhcjNF9KY+B760ISObBI3P0gU4MgTiL2MHFyBkQOd4zsLwupoD62fnaFy5MOs4OU5LCHAHmKO1Wz7AAAAAElFTkSuQmCC",alt:"keyword"}):"searchResult"===e?Object(m.jsxs)("div",{className:"icon-list",children:[Object(m.jsx)(r.b,{to:"/stop/map/".concat(a,"/").concat(c,"/").concat(s),children:Object(m.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFYSURBVHgBtVXtdcMgDORHB2AEj9AN7A3aDeINmg3wBu4GHiUjdARG8AgqKiK5UAQ4be493rORTjrxIYxpgIhsGEsYnm74CmMLYzB/QQhwDmOnOs7mEYjqBFY7cjViG2XusSRcOpBdxc+Jz35ouUDddsB31Ry8jFNSIZvIGMFvFqU/vjA/ia/XEuTY0kdBSMKuxGDuZCrGHBb88DT5hsjLtUpUS3FzZwg2ZUvkxVZcIoqb7u+EYAIguVSVaYAKmyxiYlwlgQUVr5XgeJyHzKYnEIdVTHyirJLA5+qPJMAqSgE+wW4PJ0AnwQLzCxpq3BfTDwexXDers4KZfuPUw+1KIN/vFO/A9R78awL552NpNXs1AUGzawWg2yvX5lLWxAiewmyJOOgHxT5Tgsrln7cCEf9Xum92u8yNLW5e+iAqtHf4IlWULlaRa5QNSl3VC8GR0i4aXG+ejW8aET4uen1MCwAAAABJRU5ErkJggg==",alt:"Map marker"})}),Object(m.jsx)("img",{src:S,alt:"menu"})]}):Object(m.jsx)("img",{src:S,alt:"menu"})})]})};const R=d.a.div(C||(C=Object(l.a)(["\ndisplay:flex;\nflex-direction: column;\n"]))),E=d.a.div(w||(w=Object(l.a)(["\nflex: 1;\nheight: 100vh;\n"])));var B,T,k,F=()=>{const{ptxURL:t,ptxAuthorityURL:e,stationIcon:n,userIcon:c,getAuthorizationHeader:s,getMinute:o}=v,[i,r]=Object(a.useState)([25.04270187676874,121.54349674470315]),[l,d]=Object(a.useState)([]),[u,b]=Object(a.useState)({}),[O,x]=Object(a.useState)(""),[g,f]=Object(a.useState)(""),[S,N]=Object(a.useState)([]),[y,U]=Object(a.useState)([]),[I,C]=Object(a.useState)([]),[w,B]=Object(a.useState)(13),[T,k]=Object(a.useState)("");let[F,z]=Object(a.useState)(null);const Y=Object(a.useRef)("");return Object(a.useEffect)((()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition((t=>{r([t.coords.latitude,t.coords.longitude])}))}),[]),Object(a.useEffect)((()=>{if(Y.current){const t=Y.current.setView(i,w),e=j.a.marker(i,{icon:c});Y.current.addLayer(e),t.on("zoomend",(function(e){const n=t.getZoom();B(n)}))}}),[i,w,c]),Object(a.useEffect)((()=>{fetch("".concat(t,"/Station/NearBy?$top=").concat(30,"&$spatialFilter=nearby(").concat(i,",1000)&$format=JSON"),{headers:s()}).then((t=>t.json())).then((t=>{d(t)})).catch((t=>{console.log(t)}))}),[t,i,s]),Object(a.useEffect)((()=>{l&&l.length&&z(l.map((e=>Object(m.jsx)(p.a,{position:[e.StationPosition.PositionLat,e.StationPosition.PositionLon],icon:n,eventHandlers:{click:()=>{x(e.StationName.Zh_tw),console.log(O),e.Stops.forEach((e=>{console.log(e),fetch("".concat(t,"/StopOfRoute/City/").concat(T,"?$filter=RouteUID%20eq%20'").concat(e.RouteUID,"'&$top=30&$format=JSON"),{headers:s()}).then((t=>t.json())).then((t=>{console.log(t),t.length&&b({stops:t,routeUID:t[0].RouteUID})})).catch((t=>{console.log(t)}))}))}}},e.StopUID))))}),[t,l,n,T,s]),Object(a.useEffect)((()=>{if(l&&l.length){const t=l[0].StationUID.replace(/[0-9]/g,"");fetch("".concat(e,"?$filter=AuthorityCode%20eq%20'").concat(t,"'&$top=30&$format=JSON"),{headers:s()}).then((t=>t.json())).then((t=>{const e=v.countyList.find((e=>e.label===t[0].AuthorityName.Zh_tw.slice(0,3))).value;k(e)})).catch((t=>{console.log(t)}))}}),[e,l,s]),Object(a.useEffect)((()=>{const{stops:e,routeUID:n}=u;T&&fetch("".concat(t,"/EstimatedTimeOfArrival/City/").concat(T,"?$filter=RouteUID%20eq%20'").concat(n,"'&$format=JSON"),{headers:s()}).then((t=>t.json())).then((t=>{e&&e.length&&(U(e[0].Stops.map((n=>{var a;const{PlateNumb:c,EstimateTime:s,StopStatus:o}=null!==(a=t.find((t=>t.StopUID===n.StopUID&&t.StopName.Zh_tw===O)))&&void 0!==a?a:{};return{destinationName:"\u5f80".concat(e[0].Stops[e[0].Stops.length-1].StopName.Zh_tw),routeName:e[0].RouteName.Zh_tw,stopUID:n.StopUID,stopName:n.StopName.Zh_tw,stopStatus:o,plateNumb:c,estimatedSeconds:s}}))),e.length>1&&C(e[1].Stops.map((n=>{var a;const{PlateNumb:c,EstimateTime:s,StopStatus:o}=null!==(a=t.find((t=>t.StopUID===n.StopUID)))&&void 0!==a?a:{};return{destinationName:"\u5f80".concat(e[0].Stops[e[0].Stops.length-1].StopName.Zh_tw),routeName:e[0].RouteName.Zh_tw,stopUID:n.StopUID,stopName:n.StopName.Zh_tw,stopStatus:o,plateNumb:c,estimatedSeconds:s}}))))})).catch((t=>{console.log(t)}))}),[s,t,u,T,O]),Object(a.useEffect)((()=>{y&&y.length&&(console.log(g),N([...S,...y.filter((t=>t.stopName===O))]))}),[y,O]),Object(a.useEffect)((()=>{I&&I.length}),[I,O]),Object(m.jsxs)(R,{children:[Object(m.jsx)(D,{type:"map",text:"\u9644\u8fd1\u7684\u516c\u8eca\u7ad9",router:"/"}),Object(m.jsx)(E,{children:Object(m.jsxs)(A.a,{className:"map markercluster-map",ref:Y,useFlyTo:!0,zoom:w,center:i,scrollWheelZoom:!0,children:[Object(m.jsx)(h.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),F,S&&S.map((t=>Object(m.jsxs)("div",{className:"popup-container",children:[Object(m.jsx)("div",{className:"popup-title",children:t.stopName}),Object(m.jsxs)("div",{className:"popup-wrapper",children:[o(t),Object(m.jsx)("div",{children:t.routeName}),Object(m.jsx)("div",{className:"dash",children:"-"}),Object(m.jsx)("div",{className:"destination-name",children:t.destinationName})]})]},t.stopUID)))]})})]})};d.a.div(B||(B=Object(l.a)(["\nflex: 0 1 auto;\nwidth:30%;\n\n    div{\n        width: 100%;\n        margin-right: 12px;\n    }\n"])));const z=d.a.div(T||(T=Object(l.a)(["\ndisplay: flex;\nflex-wrap: wrap;\nalign-content: flex-start;\nheight: 100vh;\noverflow-y: auto;\nposition: relative;\ntop: 55px;\nmax-height: calc(100vh - 70px);\n"]))),Y=d.a.div(k||(k=Object(l.a)(["\ndisplay: flex;\npadding-top: 1px;\nfont-size: 14px;\n"])));var L,Q,Z,H,M,J,V,P,X=()=>{const{selectedCounty:t}=Object(i.g)(),{ptxURL:e,getAuthorizationHeader:n}=v;let[c,s]=Object(a.useState)([]),[o,l]=Object(a.useState)([]);let d=[];Object(a.useEffect)((()=>{fetch("".concat(e,"/Route/City/").concat(t,"?$top=400&$format=JSON"),{headers:n()}).then((t=>t.json())).then((t=>{s(t),l(t)})).catch((t=>{console.log(t)}))}),[t,n,e]);return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(D,{type:"input",text:"\u9644\u8fd1\u7684\u516c\u5171\u55ae\u8eca",router:"/",searchText:"",handleSearch:t=>{d=[],t?(c.forEach((e=>{e.RouteName.Zh_tw.indexOf(t)>=0&&d.push(e)})),l(d)):l(c)}}),Object(m.jsx)(z,{children:o&&o.length>=1&&o.map((e=>Object(m.jsxs)(r.b,{className:"stop-item",to:"/stop/".concat(t,"/").concat(e.RouteUID,"/").concat(e.RouteName.Zh_tw),children:[Object(m.jsx)("div",{className:"name",children:e.RouteName.Zh_tw}),Object(m.jsxs)(Y,{children:[Object(m.jsx)("div",{className:"stop-name",children:e.DepartureStopNameZh}),Object(m.jsx)("div",{className:"dash",children:"-"}),Object(m.jsxs)("div",{className:"stop-name",children:[" ",e.DestinationStopNameZh]})]},e.RouteUID)]},e.RouteUID)))})]})};const K=d.a.div(L||(L=Object(l.a)(["\ndisplay: flex;\nflex-direction: column;\njustify-content: center;\nalign-items: center;\nwidth: 100%;\nheight: 100%;\n"]))),W=d.a.div(Q||(Q=Object(l.a)([""]))),G=d.a.div(Z||(Z=Object(l.a)(["\npadding-top: 82px;\npadding-bottom: 55px;\n"]))),q=d.a.div(H||(H=Object(l.a)(["\ndisplay:flex;\njustify-content: center;\nmargin: 10px 0 24px 0;\n"]))),$=d.a.div(M||(M=Object(l.a)(["\nbackground-color: #F8F8F8;\nbox-shadow: 0px 2px 1px 1px rgba(0, 0, 0, 0.15);\nborder-radius: 4px;\npadding: 8px 40px;\ndisplay: flex;\njustify-content: center;\nalign-items: center;\nflex-wrap: nowrap;\ncursor: pointer;\n    \n    &:first-of-type{\n        margin-right:5px;\n    }\n\n    &:last-child{\n        margin-left:5px;\n    }\n\n    .choose-btn{\n        display: flex;\n        align-items: center;\n    }\n\n    div{\n        padding-left: 3px;\n    }\n"]))),_=d.a.div(J||(J=Object(l.a)([""]))),tt=d.a.div(V||(V=Object(l.a)(["\nfont-size: 16px;\nmargin-bottom: 6px;\ntext-align: center;\nwidth: 100%;\n"]))),et=d.a.div(P||(P=Object(l.a)(["\ndisplay: flex;\nflex-wrap: wrap;\njustify-content: center;\npadding: 0 15px;\n"])));var nt,at,ct,st,ot,it,rt,lt=()=>{const t=v.countyList;return Object(m.jsxs)(K,{children:[Object(m.jsx)(G,{children:Object(m.jsx)("div",{className:"logo"})}),Object(m.jsx)("div",{className:"home-title",children:"\u53f0\u7063\u642d\u516c\u8eca"}),Object(m.jsx)(W,{className:"home"}),Object(m.jsxs)(q,{children:[Object(m.jsx)($,{children:Object(m.jsxs)(r.b,{className:"choose-btn",to:"/bus",children:[Object(m.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAPASURBVHgB7ZdRUtswEEB3HYYw0E5zBPcEhBMUTlD4bEIHJxdomCmkTD+SfDGkH8ABis1MCZ+EE0BvkJ6g4QTNDwyBWlutZVtKxknsTD/ZDyLJ0u7TanclAF5ECcKc4riNAiyu2GD5hWDg8bHnVVoDmEMyQbBha3G5RhbuAIGdMKWHRNfCEp734aAPKSU1RLVzVCOwGgBUmDmZYIDgn56VD5qQQmZC8O5x6dUVEK2P2qFb+dMDtAZAQoJZRYTRObLfFcOHyqxjWoBZlIsrNxKgGBsnasLTw2mSYsc9tGFxYQdRzglAcRPzy+y5jak2pn2sXhw1CbERmu8T4ZZX3u/BDHEu2kUJciXV28oInZyV6ruQFcK5PLSRcr/D7oCG/ppX0cEmDTmWBe/ksch5OJDx0nVLn89HQeBGNoMYInpe88pfe5kgqpdtlwgcpUDUvPKXUwOOldsJy/qE/kaUGc6PoxpaeKwMUVd6Yys1hOMeFzD//Ef1qO+W6m9TAGiQ4f1aFDOVTpv1FDhj6On+bVIsWYlqlv4agYi38WRhOTEAEbt23S3ty9IAawwbTrNhaflTvB7QA7XdAiwsFZPMJUMgrcbNHHZjhWi9j9tPYksC/OQ2BysNBWfAQC1HB/QufmlrudX0EIS6IAky3KdSlWuEGaQBSNDHaMzWFrBvtAvpIUZmjCxUOwW0kyeH1ZQg0x2SDCHoLlbrk60/YJRidvXisGku4bIOoQcISaeiebRkeMWQSRWzZ2DqIPWhhTlYV4ZyjWqnvSoQezLF1sko69JTzXg5QZFiZaKfZCzRE2FVVK4XsBlc2zz+ce9WZkszhgLYRC7jBgCX9ShgVR/Cb5zqenwmhDKgUwvzr99rwL0WkV8xUjJaIfvkeOV6KxrhqgrRERmpPi6TLzAfriEHNdURTfnnXIMcePyjSvPCG0uI/vftz3fjKmTZbsSdJ781ydTUC6zS+Saro3I1Cdr1tusnkFLMy0+mdNebULJZpqaoPN/45kOpkMs2pBCep29fKUOxO23+VIigEgKq3XNsyHsjCtKJAPwIUvdLIByo44UtE0QAUtrjXcT1wcovu1MV5lf4ux0i9M1AnRsiUDX0+TyDlOXXUvWinQhS6Rx5nLYRQHifzJTUD93xRwoSeGfl/YoJIEd3wu5A1oeNNK+wTBAK5NBBzLl6sXzIoti1KHesPQBc9h13u36eVm/mf35CEH4tJQXoQALUsgDMBaFARh+yEUCWIzAlVWCOi37EhKVbvrKCh/AcAP9F2CuzaseLpJV/bjbDWS67zzgAAAAASUVORK5CYII=",alt:"stop"}),Object(m.jsx)("div",{children:"\u9644\u8fd1\u7ad9\u724c"})]})}),Object(m.jsx)($,{children:Object(m.jsxs)(r.b,{className:"choose-btn",to:"/bicycle",children:[Object(m.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIQSURBVHgB7VNNTttAFH5vbAiKuqA3oDfgCM4Nuk6KPOYCDVJLmpWdVRVSCXKBeqI26bY3ID1B0xP0Ctnwk8D48WYcGxOZiJAFGz7JGs+8972f780AvOKlgbAmgtEJFbYTml3UVNCZPuYvYDPsw0714yqHtTvIIH/0PHToHAimceP47bMSLMlhEdePsWD/z8seaV1TB+1xWYyNJCJEZX9cx3/MZ2UCUy3NtvL2eaAPpbh2+2bBBN7LONwti5G3K3+xpgAha7rPoXYBaQzkqLj+aRCMeud85sFTUODlCQ6H3YjbDcv9dYcc9y8k9BvWgOF9b7QjIYcnchF8SpQ0jQz2S+jIOBI6IWky0ti7Lipiz0pHEBTiWRvN9DsiHdhYzAtG33yBAu2AOHikGl/65tHY70PrjBNHthoknyAdqJ5rac/ueU3eTWyaHeGrRltxcZ00r5Yue3j2f341yMrJrydltxR5PqkfEkZsj3Ib88h98w8d8Hh+6aBvthVUbk4NT2TtbQJ18HnMi6fqraNlm5u2x9VtVSXvz8xh9pgOR90mS3NKQGMm14rE/GYteMz5k9lEZS6ZB4bnEt0OEB0PedDyZ5fbu1TWabtqgtubxdnUcmUESR+NdMu8SpWDi9B4GJ6tVA57IQ8yghIQEQ+/1SmzPYV3/9CGXyWg6y+GOeX2JqaCuN4awAqU8zAqSvaKl8UdNjYGROLmcnwAAAAASUVORK5CYII=",alt:"bike"}),Object(m.jsx)("div",{children:"\u9644\u8fd1\u55ae\u8eca"})]})})]}),Object(m.jsxs)(_,{children:[Object(m.jsx)(tt,{children:"\u67e5\u8a62\u516c\u8eca"}),Object(m.jsx)(et,{children:t&&t.map((t=>Object(m.jsx)(r.b,{className:"route-item",to:"/search/".concat(t.value),children:t.label})))})]})]})};const dt=d.a.div(nt||(nt=Object(l.a)(["\ndisplay: flex;\nflex-direction: column;\nwidth: 100%;\nposition: relative;\ntop: 95px;\nmax-height: calc(100vh - 120px);\n"]))),ut=d.a.div(at||(at=Object(l.a)(["\ndisplay: flex;\npadding: 4px 15px 0 0;\njustify-content:flex-end;\nposition: relative;\nfont-size: 14px;\ncolor: #666666;\n"]))),jt=d.a.div(ct||(ct=Object(l.a)(["\npadding: 12px 15px;\nfont-size:16px;\ntext-align: left;\n\n    &:after{\n        content:'';\n        display: block;\n        border-bottom: 1px solid #CCCCCC;\n    }\n    &:first-of-type{\n        padding: 4px 15px 12px 15px;\n    }\n"]))),pt=d.a.div(st||(st=Object(l.a)(["\ndisplay: flex;\npadding-bottom: 12px;\n"]))),At=d.a.div(ot||(ot=Object(l.a)(["\nposition: relative;\noverflow: auto;\ntop: 25px;\n"]))),ht=d.a.div(it||(it=Object(l.a)(["\ndisplay: flex;\nbackground-color: #438C6F;\ncolor: #FFFFFF;\npadding: 8px 50px;\nfont-size: 14px;\nposition: fixed;\ntop: 55px;\nwidth: 100%;\nz-index: 10;\n"]))),bt=d.a.div(rt||(rt=Object(l.a)(["\nwidth: 50%;\ndisplay: flex;\njustify-content: center;\ncursor: pointer;\ncolor: #CCCCCC;\n\n    &.active{\n        color: #FFFFFF;\n    }\n"])));var mt,Ot,xt,gt=()=>{var t;const{selectedCounty:e,routeUID:n,routeName:c}=Object(i.g)(),{ptxURL:s,getAuthorizationHeader:o,getMinute:r}=v,[l,d]=Object(a.useState)([]),[u,j]=Object(a.useState)([]),[p,A]=Object(a.useState)(!0),[h,b]=Object(a.useState)(0);function O(t,e,n){var a;return null===(a=e.find((e=>{let{Direction:n}=e;return n===t})))||void 0===a?void 0:a.Stops.map((e=>{var a;const{PlateNumb:c,EstimateTime:s,StopStatus:o}=null!==(a=n.find((n=>{let{Direction:a,StopUID:c}=n;return a===t&&c===e.StopUID})))&&void 0!==a?a:{};return{stopUID:e.StopUID,stopName:e.StopName.Zh_tw,stopStatus:o,plateNumb:c,estimatedSeconds:s}})).filter(((t,e,n)=>e===n.findIndex((e=>t.stopUID===e.stopUID))))}const x=Object(a.useCallback)((()=>{(async()=>{const[{value:t},{value:e}]=await Promise.allSettled([f(),g()]);d(O(0,e,t)),j(O(1,e,t)),b(0)})()}),[]),g=async()=>{const t=await fetch("".concat(s,"/StopOfRoute/City/").concat(e,"?$filter=RouteUID%20eq%20'").concat(n,"'&$format=JSON"),{headers:o()});return await t.json()},f=async()=>{const t=await fetch("".concat(s,"/EstimatedTimeOfArrival/City/").concat(e,"?$filter=RouteUID%20eq%20'").concat(n,"'&$format=JSON"),{headers:o()});return await t.json()};return Object(a.useEffect)((()=>{x()}),[x]),Object(a.useEffect)((()=>{const t=setInterval(x,6e4),e=setInterval((()=>{b((t=>++t))}),1e3);return x(),()=>{clearInterval(t),clearInterval(e)}}),[]),Object(m.jsxs)("div",{children:[Object(m.jsx)(D,{type:"searchResult",selectedCounty:e,routeUID:n,routeName:c,router:"/search/".concat(e)}),Object(m.jsxs)(dt,{children:[Object(m.jsxs)(ht,{children:[Object(m.jsx)(bt,{className:"".concat(p?"active":""),onClick:()=>A(!0),children:l&&l.length?"\u5f80".concat(l[l.length-1].stopName):"\u6c92\u6709\u53bb\u7a0b"}),Object(m.jsx)(bt,{className:"".concat(p?"":"active"),onClick:()=>A(!1),children:u&&u.length?"\u5f80".concat(null===(t=u[u.length-1])||void 0===t?void 0:t.stopName):"\u6c92\u6709\u56de\u7a0b"})]}),Object(m.jsxs)(ut,{children:[h,"\u79d2\u524d\u66f4\u65b0"]}),Object(m.jsx)(At,{children:p&&l&&l.length&&l.map((t=>Object(m.jsx)(jt,{children:Object(m.jsxs)(pt,{children:[Object(m.jsx)("div",{children:r(t)}),Object(m.jsx)("div",{children:t.stopName})]})},t.StopUID)))}),Object(m.jsx)(At,{children:!p&&u&&u.length&&u.map((t=>Object(m.jsx)(jt,{children:Object(m.jsxs)(pt,{children:[Object(m.jsx)("div",{children:r(t)}),Object(m.jsx)("div",{children:t.stopName})]})},t.StopUID)))})]})]})},ft=n(28),vt=n.n(ft);const St=d.a.div(mt||(mt=Object(l.a)(["\ndisplay: flex;\nflex-direction: column;\nwidth: 100%;\nposition: relative;\nmax-height: calc(100vh - 95px);\n"]))),Nt=d.a.div(Ot||(Ot=Object(l.a)(["\ndisplay: flex;\nbackground-color: #438C6F;\ncolor: #FFFFFF;\npadding: 8px 50px;\nfont-size: 14px;\nposition: fixed;\ntop: 55px;\nwidth: 100%;\nz-index: 10;\n"]))),yt=d.a.div(xt||(xt=Object(l.a)(["\nwidth: 50%;\ndisplay: flex;\njustify-content: center;\ncursor: pointer;\ncolor: #CCCCCC;\n\n    &.active{\n        color: #FFFFFF;\n    }\n"])));var Ut=()=>{var t;const{selectedCounty:e,routeUID:n,routeName:c}=Object(i.g)(),{ptxURL:s,emptyPositionIcon:o,getAuthorizationHeader:r}=v,[l,d]=Object(a.useState)([25.04270187676874,121.54349674470315]),[u,b]=Object(a.useState)([]),[O,x]=Object(a.useState)([]),[g,f]=Object(a.useState)(!1),[S,N]=Object(a.useState)([]),[y,U]=Object(a.useState)(null),I=Object(a.useRef)("");function C(t,e,n){var a;return null===(a=e.find((e=>{let{Direction:n}=e;return n===t})))||void 0===a?void 0:a.Stops.map((e=>{var a;const{PlateNumb:c,EstimateTime:s,StopStatus:o}=null!==(a=n.find((n=>{let{Direction:a,StopUID:c}=n;return a===t&&c===e.StopUID})))&&void 0!==a?a:{};return{stopUID:e.StopUID,stopName:e.StopName.Zh_tw,stopStatus:o,plateNumb:c,estimatedSeconds:s}})).filter(((t,e,n)=>e===n.findIndex((e=>t.stopUID===e.stopUID))))}const w=Object(a.useCallback)((()=>{(async()=>{const[{value:t},{value:e}]=await Promise.allSettled([E(),R()]);b(C(0,e,t)),x(C(1,e,t))})()}),[]),R=async()=>{const t=await fetch("".concat(s,"/StopOfRoute/City/").concat(e,"?$filter=RouteUID%20eq%20'").concat(n,"'&$format=JSON"),{headers:r()});return await t.json()},E=async()=>{const t=await fetch("".concat(s,"/EstimatedTimeOfArrival/City/").concat(e,"?$filter=RouteUID%20eq%20'").concat(n,"'&$format=JSON"),{headers:r()});return await t.json()};return Object(a.useEffect)((()=>{w()}),[w]),Object(a.useEffect)((()=>{fetch("".concat(s,"/Shape/City/").concat(e,"?$filter=RouteUID%20eq%20'").concat(n,"'&$top=").concat(100,"&$format=JSON"),{headers:r()}).then((t=>t.json())).then((function(t){N(t)})).catch((function(t){console.log(t)}))}),[e]),Object(a.useEffect)((()=>{const t=new vt.a.Wkt;if(S&&S.length){t.read(S[0].Geometry),t.write(),d([t.toJson().coordinates[0][1],t.toJson().coordinates[0][0]]),U(t.toJson().coordinates.map(((t,e)=>Object(m.jsx)(p.a,{position:[t[1],t[0]],icon:o},e))));const e={type:"Feature",properties:{},geometry:t.toJson()};j.a.geoJSON(e).addTo(I.current)}}),[S,o]),Object(a.useEffect)((()=>{I&&I.current&&I.current.flyTo(l,14)}),[l]),Object(m.jsxs)("div",{children:[Object(m.jsx)(D,{type:"map",text:c,router:"/stop/".concat(e,"/").concat(n,"/").concat(c)}),Object(m.jsxs)(St,{children:[Object(m.jsxs)(Nt,{children:[Object(m.jsx)(yt,{className:"".concat(g?"active":""),onClick:()=>f(!0),children:u.length?"\u5f80".concat(u[u.length-1].stopName):"\u6c92\u6709\u53bb\u7a0b"}),Object(m.jsx)(yt,{className:"".concat(g?"":"active"),onClick:()=>f(!1),children:O.length?"\u5f80".concat(null===(t=O[O.length-1])||void 0===t?void 0:t.stopName):"\u6c92\u6709\u56de\u7a0b"})]}),Object(m.jsxs)(A.a,{className:"map markercluster-map",ref:I,useFlyTo:!0,zoom:15,center:l,scrollWheelZoom:!0,whenCreated:t=>{I.current=t},children:[Object(m.jsx)(h.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),y]})]})]})},It=n(47),Ct=(n(25),n(29)),wt=n.n(Ct);n(42);var Dt=()=>{const{ptxBicycleURL:t,ptxAuthorityURL:e,userIcon:n,getAuthorizationHeader:c,bikeIcon:s}=v,[o,i]=Object(a.useState)([51.505,-.09]),[r,l]=Object(a.useState)([]),[d,u]=Object(a.useState)(""),[b,O]=Object(a.useState)([]),[x,g]=Object(a.useState)(13);let[f,S]=Object(a.useState)(null);const N=[{code:0,status:"\u505c\u6b62\u71df\u904b"},{code:1,status:"\u6b63\u5e38\u71df\u904b"},{code:2,status:"\u66ab\u505c\u71df\u904b"}],y=Object(a.useRef)(""),U=Object(a.useRef)(""),I=Object(a.useRef)([]);Object(a.useEffect)((()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition((t=>{i([t.coords.latitude,t.coords.longitude])}))}),[]),Object(a.useEffect)((()=>{if(y.current){const t=y.current.setView(o,x),e=j.a.marker(o,{icon:n});y.current.addLayer(e),t.on("zoomend",(function(e){const n=t.getZoom();g(n)}))}fetch("".concat(t,"/Station/NearBy?$spatialFilter=nearby(").concat(o,",1000)&$format=JSON"),{headers:c()}).then((t=>t.json())).then((function(t){l(t)})).catch((function(t){console.log(t)})),fetch("".concat(t,"/Availability/NearBy?$spatialFilter=nearby(").concat(o,",1000)&$format=JSON"),{headers:c()}).then((t=>t.json())).then((function(t){O(t)})).catch((function(t){console.log(t)}))}),[o,c,t,x,n]),Object(a.useEffect)((()=>{if(r&&r.length){const t=r[0].StationUID.replace(/[0-9]/g,"");fetch("".concat(e,"?$filter=AuthorityCode%20eq%20'").concat(t,"'&$top=30&$format=JSON"),{headers:c()}).then((t=>t.json())).then((t=>{const e=v.countyList.find((e=>e.label===t[0].AuthorityName.Zh_tw.slice(0,3))).value;u(e)})).catch((t=>{console.log(t)}))}}),[e,r,c]),Object(a.useEffect)((()=>{const t=[];r.forEach((e=>{const n=b.findIndex((t=>t.StationUID===e.StationUID));-1!==n&&t.push({...e,...b[n]})})),I.current=t}),[r,b]),Object(a.useEffect)((()=>{d&&fetch("".concat(t,"/Availability/").concat(d,"?$top=30&$format=JSON"),{headers:c()}).then((t=>t.json())).then((function(t){O(t)})).catch((function(t){console.log(t)}))}),[t,c,d]);return Object(a.useEffect)((()=>{I.current&&I.current.length&&S(I.current.map((t=>Object(m.jsx)(p.a,{position:[t.StationPosition.PositionLat,t.StationPosition.PositionLon],icon:s,children:Object(m.jsxs)(It.a,{ref:U,className:"bicycle-container",children:[Object(m.jsx)("div",{className:"station-name",children:t.StationName.Zh_tw}),Object(m.jsx)("div",{className:"station-address",children:t.StationAddress.Zh_tw}),Object(m.jsx)("div",{className:"station-updated-time",children:t.UpdateTime.slice(0,-9).replace("T"," ")}),Object(m.jsx)("div",{className:"station-status"+(2===t.ServiceStatus?"closed ":"")+(0===t.ServiceStatus?"stop ":""),children:N.find((e=>e.code===t.ServiceStatus)).status}),Object(m.jsxs)("div",{className:"station-availability",children:[Object(m.jsxs)("div",{className:"rent",children:[Object(m.jsx)("div",{className:"name",children:"\u53ef\u501f\u55ae\u8eca"}),Object(m.jsx)("div",{className:"number",children:t.AvailableRentBikes})]}),Object(m.jsxs)("div",{className:"return",children:[Object(m.jsx)("div",{className:"name",children:"\u53ef\u505c\u7a7a\u4f4d"}),Object(m.jsx)("div",{className:"number",children:t.AvailableReturnBikes})]})]})]})},t.StationUID))))}),[I.current]),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(D,{type:"map",text:"\u9644\u8fd1\u7684\u516c\u5171\u55ae\u8eca",router:"/"}),Object(m.jsxs)(A.a,{className:"map markercluster-map",ref:y,useFlyTo:!0,zoom:x,center:o,scrollWheelZoom:!0,whenCreated:t=>{y.current=t},children:[Object(m.jsx)(h.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),Object(m.jsx)(wt.a,{chunkedLoading:!0,iconCreateFunction:function(t){return j.a.divIcon({html:"<span>".concat(t.getChildCount(),"</span>"),className:"marker-cluster-custom",iconSize:j.a.point(40,40,!0)})},children:f})]})]})};var Rt=function(){return Object(m.jsx)("div",{className:"App",children:Object(m.jsx)(r.a,{children:Object(m.jsxs)(i.c,{children:[Object(m.jsx)(i.a,{path:"/",element:Object(m.jsx)(lt,{})}),Object(m.jsx)(i.a,{path:"/bus",element:Object(m.jsx)(F,{})}),Object(m.jsx)(i.a,{path:"/bicycle",element:Object(m.jsx)(Dt,{})}),Object(m.jsx)(i.a,{path:"/search/:selectedCounty",element:Object(m.jsx)(X,{})}),Object(m.jsx)(i.a,{path:"/stop/:selectedCounty/:routeUID/:routeName",element:Object(m.jsx)(gt,{})}),Object(m.jsx)(i.a,{path:"/stop/map/:selectedCounty/:routeUID/:routeName",element:Object(m.jsx)(Ut,{})})]})})})};var Et=t=>{t&&t instanceof Function&&n.e(3).then(n.bind(null,48)).then((e=>{let{getCLS:n,getFID:a,getFCP:c,getLCP:s,getTTFB:o}=e;n(t),a(t),c(t),s(t),o(t)}))};o.a.render(Object(m.jsx)(c.a.StrictMode,{children:Object(m.jsx)(Rt,{})}),document.getElementById("root")),Et()}},[[43,1,2]]]);
//# sourceMappingURL=main.cbfe2fb7.chunk.js.map